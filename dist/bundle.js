!function(r,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("chainpointClient",[],t):"object"==typeof exports?exports.chainpointClient=t():r.chainpointClient=t()}(global,function(){return function(r){var t={};function e(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return r[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=r,e.c=t,e.d=function(r,t,n){e.o(r,t)||Object.defineProperty(r,t,{enumerable:!0,get:n})},e.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,t){if(1&t&&(r=e(r)),8&t)return r;if(4&t&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&t&&"string"!=typeof r)for(var o in r)e.d(n,o,function(t){return r[t]}.bind(null,o));return n},e.n=function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(t,"a",t),t},e.o=function(r,t){return Object.prototype.hasOwnProperty.call(r,t)},e.p="",e(e.s=1)}([function(r,t){r.exports=require("lodash")},function(r,t,e){e(2),r.exports=e(3)},function(r,t){r.exports=require("@babel/polyfill")},function(r,t,e){"use strict";e.r(t),function(r){var t=e(0);function n(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var e=[],n=!0,o=!1,i=void 0;try{for(var a,c=r[Symbol.iterator]();!(n=(a=c.next()).done)&&(e.push(a.value),!t||e.length!==t);n=!0);}catch(r){o=!0,i=r}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return e}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(r,t,e,n,o,i,a){try{var c=r[i](a),u=c.value}catch(r){return void e(r)}c.done?t(u):Promise.resolve(u).then(n,o)}function i(r){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}var a=e(5),c=e(6),u=e(7),s=e(8),f=e(9),h=e(10),p=e(11),l=e(12),b=e(13),d=e(14),j=e(15),m="https://node-proxy.chainpoint.org:443";a.config({warnings:{wForgottenReturn:!1}});var y="_core.addr.chainpoint.org";function O(r,e){if(e=e||function(){},r=r||1,!Object(t.isInteger)(r)||r<1)throw new Error("num arg must be an Integer >= 1");return new a(function(n,o){if(!c||!Object(t.isFunction)(c.resolveTxt)){var i=Object(t.slice)(Object(t.shuffle)(["https://a.chainpoint.org","https://b.chainpoint.org","https://c.chainpoint.org"]),0,r);return n(i),e(null,i)}c.resolveTxt(y,function(i,a){if(i)return o(i),e(i);if(Object(t.isEmpty)(a)){var c=new Error("no core addresses available");return o(c),e(c)}var u=Object(t.map)(a,function(r){return"https://"+r}),f=Object(t.shuffle)(u),h=Object(t.filter)(f,function(r){return function(r){if(Object(t.isEmpty)(r)||!Object(t.isString)(r))return!1;try{return s.isURL(r,{protocols:["https"],require_protocol:!0,host_whitelist:[/^[a-z]\.chainpoint\.org$/]})}catch(r){return!1}}(r)}),p=Object(t.slice)(h,0,r);return n(p),e(null,p)})})}function w(r){if(!Object(t.isString)(r))return!1;try{var e=s.isURL(r,{protocols:["http","https"],require_protocol:!0,host_blacklist:["0.0.0.0"]}),n=u.parse(r).hostname;return e&&s.isIP(n,4)}catch(r){return!1}}function v(){return"object"===("undefined"==typeof window?"undefined":i(window))&&"https:"===window.location.protocol}function g(r,e){if(e=e||function(){},r=r||3,!Object(t.isInteger)(r)||r<1)throw new Error("num arg must be an Integer >= 1");return new a(function(n,o){O(1).then(function(i){var a=Object(t.first)(i)+"/nodes/random";p({uri:a,json:!0,timeout:1e4},function(i,a,c){if(i)return o(i),e(i);var u=Object(t.map)(c,"public_uri"),s=Object(t.shuffle)(u),f=Object(t.filter)(s,function(r){return w(r)}),h=Object(t.slice)(f,0,r);if(!h.length)throw new Error("There seems to be an issue retrieving a list of available nodes. Please try again.");return n(h),e(null,h)})}).catch(function(r){return o(r),e(r)})})}function E(r){return/^[0-9a-f]{2,}$/i.test(r)&&!(r.length%2)}function _(r){if(!Object(t.isArray)(r))throw new Error("parsedProofs arg must be an Array");if(Object(t.isEmpty)(r))throw new Error("parsedProofs arg must be a non-empty Array");var e=[];return Object(t.forEach)(r,function(r){var n=function r(e){var n=[];Object(t.forEach)(e,function(e){var o=e.anchors;Object(t.forEach)(o,function(r){var t={};t.branch=e.label||void 0,t.uri=r.uris[0],t.type=r.type,t.anchor_id=r.anchor_id,t.expected_value=r.expected_value,n.push(t)}),e.branches&&(n=n.concat(r(e.branches)))});return n}(r.branches);Object(t.forEach)(n,function(t){var n={};n.hash=r.hash,n.hash_id_node=r.hash_id_node,n.hash_id_core=r.hash_id_core,n.hash_submitted_node_at=r.hash_submitted_node_at,n.hash_submitted_core_at=r.hash_submitted_core_at,n.branch=t.branch,n.uri=t.uri,n.type=t.type,n.anchor_id=t.anchor_id,n.expected_value=t.expected_value,e.push(n)})}),e}function x(r,e,n){var o;if(e=e||[],n=n||function(){},!Object(t.isFunction)(n))throw new Error("callback arg must be a function");if(!Object(t.isArray)(r))throw new Error("hashes arg must be an Array");if(Object(t.isEmpty)(r))throw new Error("hashes arg must be a non-empty Array");if(r.length>250)throw new Error("hashes arg must be an Array with <= 250 elements");var i=Object(t.reject)(r,function(r){return E(r)});if(!Object(t.isEmpty)(i))throw new Error("hashes arg contains invalid hashes : ".concat(i.join(", ")));if(!Object(t.isArray)(e))throw new Error("uris arg must be an Array of String URIs");if(e.length>5)throw new Error("uris arg must be an Array with <= 5 elements");if(Object(t.isEmpty)(e))o=g(3);else{e=Object(t.uniq)(e);var c=Object(t.reject)(e,function(r){return w(r)});if(!Object(t.isEmpty)(c))throw new Error("uris arg contains invalid URIs : ".concat(c.join(", ")));o=a.resolve(e)}return new a(function(e,i){o.then(function(o){var c=Object(t.map)(o,function(t){var e=v()?m:t,n=Object.assign({"content-type":"application/json"},v()?{"X-Node-Uri":t}:{});return{method:"POST",uri:e+"/hashes",body:{hashes:r},headers:n,timeout:1e4,json:!0}});console.log("===================================="),console.log(c,"nodesWithPostOpts"),console.log("===================================="),a.map(c,l,{concurrency:25}).then(function(r){console.log("===================================="),console.log(r,"parsedBody"),console.log("===================================="),Object(t.forEach)(o,function(t,e){r[e].meta.submitted_to=t});var i=function(r){if(!Object(t.isArray)(r)&&!r.length)throw new Error("_mapSubmitHashesRespToProofHandles arg must be an Array");var e=[],n=[];return r[0]&&r[0].hashes&&Object(t.forEach)(r[0].hashes,function(){n.push(j())}),Object(t.forEach)(r,function(r){Object(t.forEach)(r.hashes,function(t,o){var i={};i.uri=r.meta.submitted_to,i.hash=t.hash,i.hashIdNode=t.hash_id_node,i.groupId=n[o],e.push(i)})}),e}(r);return e(i),n(null,i)},function(r){return i(r),n(r)})}).catch(function(r){throw console.error(r.message),r})})}function A(r){return new a(function(t,e){var n=b.createHash("sha256"),o=d.createReadStream(r);o.on("data",function(r){return n.update(r)}),o.on("end",function(){var e=n.digest("hex");t({path:r,hash:e})}),o.on("error",function(n){"EACCES"===n.code&&t({path:r,hash:null,error:"EACCES"}),e(n)})})}function S(r){if(!Object(t.isArray)(r))throw new Error("proofs arg must be an Array");if(Object(t.isEmpty)(r))throw new Error("proofs arg must be a non-empty Array");return _(function(r){if(!Object(t.isArray)(r))throw new Error("proofs arg must be an Array");if(Object(t.isEmpty)(r))throw new Error("proofs arg must be a non-empty Array");var e=[];return Object(t.forEach)(r,function(r){if(Object(t.isObject)(r))e.push(h.parse(r));else if(s.isJSON(r))e.push(h.parse(JSON.parse(r)));else{if(!(s.isBase64(r)||Object(t.isBuffer)(r)||E(r)))throw new Error("unknown proof format");e.push(h.parse(r))}}),e}(Object(t.map)(r,function(r){if(Object(t.isObject)(r)&&Object(t.has)(r,"proof")&&Object(t.isString)(r.proof))return r.proof;if(Object(t.isObject)(r)&&Object(t.has)(r,"type")&&"Chainpoint"===r.type)return r;if(Object(t.isString)(r)&&(s.isJSON(r)||s.isBase64(r)))return r;throw new Error("proofs arg Array has elements that are not Objects or Strings")})))}r.exports={getCores:O,getNodes:g,submitHashes:x,submitFileHashes:function(r,e,n){if(n=n||function(){},e=e||[],!Object(t.isFunction)(n))throw new Error("callback arg must be a function");if(!Object(t.isArray)(r))throw new Error("paths arg must be an Array");if(Object(t.isEmpty)(r))throw new Error("paths arg must be a non-empty Array");if(r.length>250)throw new Error("paths arg must be an Array with <= 250 elements");var i=Object(t.reject)(r,function(r){return d.existsSync(r)&&d.lstatSync(r).isFile()});if(!Object(t.isEmpty)(i))throw new Error("paths arg contains invalid paths : ".concat(i.join(", ")));if(!Object(t.isArray)(e))throw new Error("uris arg must be an Array of String URIs");if(e.length>5)throw new Error("uris arg must be an Array with <= 5 elements");return new a((c=regeneratorRuntime.mark(function t(o,i){var c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return c=[],t.prev=1,t.next=4,a.all(r.map(function(r){return A(r)}));case 4:c=t.sent,t.next=11;break;case 7:return t.prev=7,t.t0=t.catch(1),i(t.t0),t.abrupt("return",n(t.t0));case 11:if(0!==(c=c.filter(function(r){return"EACCES"===r.error&&console.error("Insufficient permission to read file '".concat(r.path,"', skipping")),"EACCES"!==r.error})).length){t.next=15;break}return o([]),t.abrupt("return",n(null,[]));case 15:x(c.map(function(r){return r.hash}),e).then(function(r){return r=r.map(function(r){return r.path=c.find(function(t){return t.hash===r.hash}).path,r}),o(r),n(null,r)},function(r){return i(r),n(r)});case 16:case"end":return t.stop()}},t,this,[[1,7]])}),u=function(){var r=this,t=arguments;return new Promise(function(e,n){var i=c.apply(r,t);function a(r){o(i,e,n,a,u,"next",r)}function u(r){o(i,e,n,a,u,"throw",r)}a(void 0)})},function(r,t){return u.apply(this,arguments)})).catch(function(r){throw console.error(r.message),r});var c,u},getProofs:function(r,e){if(e=e||function(){},!Object(t.isFunction)(e))throw new Error("callback arg must be a function");if(!Object(t.isArray)(r))throw new Error("proofHandles arg must be an Array");if(Object(t.isEmpty)(r))throw new Error("proofHandles arg must be a non-empty Array");if(!Object(t.every)(r,function(r){return function(r){if(!Object(t.isEmpty)(r)&&Object(t.isObject)(r)&&Object(t.has)(r,"uri")&&Object(t.has)(r,"hashIdNode"))return!0}(r)}))throw new Error("proofHandles Array contains invalid Objects");if(r.length>250)throw new Error("proofHandles arg must be an Array with <= 250 elements");var n=Object(t.reject)(r,function(r){return w(r.uri)});if(!Object(t.isEmpty)(n))throw new Error("some proof handles contain invalid URI values : ".concat(Object(t.map)(n,function(r){return r.uri}).join(", ")));var o=Object(t.reject)(r,function(r){return function(r){if(f(r,1))return!0}(r.hashIdNode)});if(!Object(t.isEmpty)(o))throw new Error("some proof handles contain invalid hashIdNode UUID values : ".concat(Object(t.map)(o,function(r){return r.hashIdNode}).join(", ")));return new a(function(n,o){try{var i={};Object(t.forEach)(r,function(r){Object(t.isEmpty)(i[r.uri])&&(i[r.uri]=[]),i[r.uri].push(r.hashIdNode)});var c=Object(t.map)(Object(t.keys)(i),function(r){var t=Object.assign({"content-type":"application/json"},{hashids:i[r].join(",")},v()?{"X-Node-Uri":r}:{});return{method:"GET",uri:(v()?m:r)+"/proofs",body:{},headers:t,timeout:1e4,json:!0}});a.map(c,l,{concurrency:25}).then(function(r){var i=Object(t.flatten)(r),a=[];try{Object(t.forEach)(i,function(r){r.anchors_complete=r.anchors_complete||[];var e=Object(t.mapKeys)(r,function(r,e){return Object(t.camelCase)(e)});a.push(e)})}catch(r){return o(r),e(r)}return n(a),e(null,a)},function(r){return o(r),e(r)})}catch(r){return o(r),e(r)}})},verifyProofs:function(r,e,o){o=o||function(){};var i,c=S(r);if(Object(t.isEmpty)(e))i=g(1);else{if(!Object(t.isString)(e))throw new Error("uri arg must be a String");if(!w(e))throw new Error("uri arg contains invalid Node URI : ".concat(e));i=a.resolve([e])}return new a(function(r,e){try{i.then(function(r){return Object(t.first)(r)}).then(function(r){var e=Object(t.map)(c,function(t){var e=u.parse(t.uri);return t.uri=r+e.path,t});return Object(t.uniqWith)(e,t.isEqual)}).then(function(r){var e=[];Object(t.forEach)(r,function(r){e.push(r.uri)});var n=Object(t.uniq)(e);return[r,Object(t.map)(n,function(r){var t=Object.assign({"content-type":"application/json"},v()?{"X-Node-Uri":u.parse(r).protocol+"//"+u.parse(r).host}:{});return{method:"GET",uri:v()?m+u.parse(r).path:r,body:{},headers:t,timeout:1e4,json:!0}})]}).then(function(r){var i=n(r,2),c=i[0],u=i[1];return[c,a.map(u,l,{concurrency:25}).then(function(r){var e=Object(t.flatten)(r),n={};return Object(t.forEach)(u,function(r,t){n[r.uri]=e[t]}),n}).catch(function(r){return e(r),o(r)})]}).then(function(i){var c=n(i,2),u=c[0];c[1].then(function(e){if(Object(t.isEmpty)(e))return a.reject(new Error("No hashes were found."));var n=[];return Object(t.forEach)(u,function(r){r.expected_value===e[r.uri]?(r.verified=!0,r.verified_at=(new Date).toISOString().slice(0,19)+"Z"):(r.verified=!1,r.verified_at=null);var o=Object(t.mapKeys)(r,function(r,e){return Object(t.camelCase)(e)});n.push(o)}),r(n),o(null,n)}).catch(function(r){return console.error(r.message),e(r),o(r)})}).catch(function(r){return console.error(r.message),e(r),o(r)})}catch(r){return e(r),o(r)}})},evaluateProofs:S}}.call(this,e(4)(r))},function(r,t){r.exports=function(r){if(!r.webpackPolyfill){var t=Object.create(r);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(r,t){r.exports=require("bluebird")},function(r,t){r.exports=require("dns")},function(r,t){r.exports=require("url")},function(r,t){r.exports=require("validator")},function(r,t){r.exports=require("uuid-validate")},function(r,t){r.exports=require("chainpoint-parse")},function(r,t){r.exports=require("request")},function(r,t){r.exports=require("request-promise")},function(r,t){r.exports=require("crypto")},function(r,t){r.exports=require("fs")},function(r,t){r.exports=require("uuid/v1")}])});
//# sourceMappingURL=bundle.js.map