!function(r,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("chainpointClient",[],t):"object"==typeof exports?exports.chainpointClient=t():r.chainpointClient=t()}(global,function(){return function(r){var t={};function e(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return r[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=r,e.c=t,e.d=function(r,t,n){e.o(r,t)||Object.defineProperty(r,t,{enumerable:!0,get:n})},e.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,t){if(1&t&&(r=e(r)),8&t)return r;if(4&t&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&t&&"string"!=typeof r)for(var o in r)e.d(n,o,function(t){return r[t]}.bind(null,o));return n},e.n=function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(t,"a",t),t},e.o=function(r,t){return Object.prototype.hasOwnProperty.call(r,t)},e.p="",e(e.s=1)}([function(r,t){r.exports=require("lodash")},function(r,t,e){e(2),r.exports=e(3)},function(r,t){r.exports=require("@babel/polyfill")},function(r,t,e){"use strict";e.r(t),e.d(t,"getCores",function(){return w}),e.d(t,"getNodes",function(){return E}),e.d(t,"submitHashes",function(){return A}),e.d(t,"submitFileHashes",function(){return S}),e.d(t,"getProofs",function(){return I}),e.d(t,"verifyProofs",function(){return P}),e.d(t,"evaluateProofs",function(){return C});var n=e(0);function o(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var e=[],n=!0,o=!1,i=void 0;try{for(var a,c=r[Symbol.iterator]();!(n=(a=c.next()).done)&&(e.push(a.value),!t||e.length!==t);n=!0);}catch(r){o=!0,i=r}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return e}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(r,t,e,n,o,i,a){try{var c=r[i](a),u=c.value}catch(r){return void e(r)}c.done?t(u):Promise.resolve(u).then(n,o)}function a(r){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}var c=e(4),u=e(5),s=e(6),f=e(7),h=e(8),p=e(9),l=e(10),b=e(11),d=e(12),j=e(13),m=e(14),y="https://node-proxy.chainpoint.org:443";c.config({warnings:{wForgottenReturn:!1}});var O="_core.addr.chainpoint.org";function w(r,t){if(t=t||function(){},r=r||1,!Object(n.isInteger)(r)||r<1)throw new Error("num arg must be an Integer >= 1");return new c(function(e,o){if(!u||!Object(n.isFunction)(u.resolveTxt)){var i=Object(n.slice)(Object(n.shuffle)(["https://a.chainpoint.org","https://b.chainpoint.org","https://c.chainpoint.org"]),0,r);return e(i),t(null,i)}u.resolveTxt(O,function(i,a){if(i)return o(i),t(i);if(Object(n.isEmpty)(a)){var c=new Error("no core addresses available");return o(c),t(c)}var u=Object(n.map)(a,function(r){return"https://"+r}),s=Object(n.shuffle)(u),h=Object(n.filter)(s,function(r){return function(r){if(Object(n.isEmpty)(r)||!Object(n.isString)(r))return!1;try{return f.isURL(r,{protocols:["https"],require_protocol:!0,host_whitelist:[/^[a-z]\.chainpoint\.org$/]})}catch(r){return!1}}(r)}),p=Object(n.slice)(h,0,r);return e(p),t(null,p)})})}function v(r){if(!Object(n.isString)(r))return!1;try{var t=f.isURL(r,{protocols:["http","https"],require_protocol:!0,host_blacklist:["0.0.0.0"]}),e=s.parse(r).hostname;return t&&f.isIP(e,4)}catch(r){return!1}}function g(){return"object"===("undefined"==typeof window?"undefined":a(window))&&"https:"===window.location.protocol}function E(r,t){if(t=t||function(){},r=r||3,!Object(n.isInteger)(r)||r<1)throw new Error("num arg must be an Integer >= 1");return new c(function(e,o){w(1).then(function(i){var a=Object(n.first)(i)+"/nodes/random";l({uri:a,json:!0,timeout:1e4},function(i,a,c){if(i)return o(i),t(i);var u=Object(n.map)(c,"public_uri"),s=Object(n.shuffle)(u),f=Object(n.filter)(s,function(r){return v(r)}),h=Object(n.slice)(f,0,r);if(!h.length)throw new Error("There seems to be an issue retrieving a list of available nodes. Please try again.");return e(h),t(null,h)})}).catch(function(r){return o(r),t(r)})})}function _(r){return/^[0-9a-f]{2,}$/i.test(r)&&!(r.length%2)}function x(r){if(!Object(n.isArray)(r))throw new Error("parsedProofs arg must be an Array");if(Object(n.isEmpty)(r))throw new Error("parsedProofs arg must be a non-empty Array");var t=[];return Object(n.forEach)(r,function(r){var e=function r(t){var e=[];Object(n.forEach)(t,function(t){var o=t.anchors;Object(n.forEach)(o,function(r){var n={};n.branch=t.label||void 0,n.uri=r.uris[0],n.type=r.type,n.anchor_id=r.anchor_id,n.expected_value=r.expected_value,e.push(n)}),t.branches&&(e=e.concat(r(t.branches)))});return e}(r.branches);Object(n.forEach)(e,function(e){var n={};n.hash=r.hash,n.hash_id_node=r.hash_id_node,n.hash_id_core=r.hash_id_core,n.hash_submitted_node_at=r.hash_submitted_node_at,n.hash_submitted_core_at=r.hash_submitted_core_at,n.branch=e.branch,n.uri=e.uri,n.type=e.type,n.anchor_id=e.anchor_id,n.expected_value=e.expected_value,t.push(n)})}),t}function A(r,t,e){var o;if(t=t||[],e=e||function(){},!Object(n.isFunction)(e))throw new Error("callback arg must be a function");if(!Object(n.isArray)(r))throw new Error("hashes arg must be an Array");if(Object(n.isEmpty)(r))throw new Error("hashes arg must be a non-empty Array");if(r.length>250)throw new Error("hashes arg must be an Array with <= 250 elements");var i=Object(n.reject)(r,function(r){return _(r)});if(!Object(n.isEmpty)(i))throw new Error("hashes arg contains invalid hashes : ".concat(i.join(", ")));if(!Object(n.isArray)(t))throw new Error("uris arg must be an Array of String URIs");if(t.length>5)throw new Error("uris arg must be an Array with <= 5 elements");if(Object(n.isEmpty)(t))o=E(3);else{t=Object(n.uniq)(t);var a=Object(n.reject)(t,function(r){return v(r)});if(!Object(n.isEmpty)(a))throw new Error("uris arg contains invalid URIs : ".concat(a.join(", ")));o=c.resolve(t)}return new c(function(t,i){o.then(function(o){var a=Object(n.map)(o,function(t){var e=g()?y:t,n=Object.assign({"content-type":"application/json"},g()?{"X-Node-Uri":t}:{});return{method:"POST",uri:e+"/hashes",body:{hashes:r},headers:n,timeout:1e4,json:!0}});console.log("===================================="),console.log(a,"nodesWithPostOpts"),console.log("===================================="),c.map(a,b,{concurrency:25}).then(function(r){console.log("===================================="),console.log(r,"parsedBody"),console.log("===================================="),Object(n.forEach)(o,function(t,e){r[e].meta.submitted_to=t});var i=function(r){if(!Object(n.isArray)(r)&&!r.length)throw new Error("_mapSubmitHashesRespToProofHandles arg must be an Array");var t=[],e=[];return r[0]&&r[0].hashes&&Object(n.forEach)(r[0].hashes,function(){e.push(m())}),Object(n.forEach)(r,function(r){Object(n.forEach)(r.hashes,function(n,o){var i={};i.uri=r.meta.submitted_to,i.hash=n.hash,i.hashIdNode=n.hash_id_node,i.groupId=e[o],t.push(i)})}),t}(r);return t(i),e(null,i)},function(r){return i(r),e(r)})}).catch(function(r){throw console.error(r.message),r})})}function S(r,t,e){if(e=e||function(){},t=t||[],!Object(n.isFunction)(e))throw new Error("callback arg must be a function");if(!Object(n.isArray)(r))throw new Error("paths arg must be an Array");if(Object(n.isEmpty)(r))throw new Error("paths arg must be a non-empty Array");if(r.length>250)throw new Error("paths arg must be an Array with <= 250 elements");var o=Object(n.reject)(r,function(r){return j.existsSync(r)&&j.lstatSync(r).isFile()});if(!Object(n.isEmpty)(o))throw new Error("paths arg contains invalid paths : ".concat(o.join(", ")));if(!Object(n.isArray)(t))throw new Error("uris arg must be an Array of String URIs");if(t.length>5)throw new Error("uris arg must be an Array with <= 5 elements");return new c(function(){var n,o=(n=regeneratorRuntime.mark(function n(o,i){var a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=[],n.prev=1,n.next=4,c.all(r.map(function(r){return q(r)}));case 4:a=n.sent,n.next=11;break;case 7:return n.prev=7,n.t0=n.catch(1),i(n.t0),n.abrupt("return",e(n.t0));case 11:if(0!==(a=a.filter(function(r){return"EACCES"===r.error&&console.error("Insufficient permission to read file '".concat(r.path,"', skipping")),"EACCES"!==r.error})).length){n.next=15;break}return o([]),n.abrupt("return",e(null,[]));case 15:A(a.map(function(r){return r.hash}),t).then(function(r){return r=r.map(function(r){return r.path=a.find(function(t){return t.hash===r.hash}).path,r}),o(r),e(null,r)},function(r){return i(r),e(r)});case 16:case"end":return n.stop()}},n,this,[[1,7]])}),function(){var r=this,t=arguments;return new Promise(function(e,o){var a=n.apply(r,t);function c(r){i(a,e,o,c,u,"next",r)}function u(r){i(a,e,o,c,u,"throw",r)}c(void 0)})});return function(r,t){return o.apply(this,arguments)}}()).catch(function(r){throw console.error(r.message),r})}function q(r){return new c(function(t,e){var n=d.createHash("sha256"),o=j.createReadStream(r);o.on("data",function(r){return n.update(r)}),o.on("end",function(){var e=n.digest("hex");t({path:r,hash:e})}),o.on("error",function(n){"EACCES"===n.code&&t({path:r,hash:null,error:"EACCES"}),e(n)})})}function I(r,t){if(t=t||function(){},!Object(n.isFunction)(t))throw new Error("callback arg must be a function");if(!Object(n.isArray)(r))throw new Error("proofHandles arg must be an Array");if(Object(n.isEmpty)(r))throw new Error("proofHandles arg must be a non-empty Array");if(!Object(n.every)(r,function(r){return function(r){if(!Object(n.isEmpty)(r)&&Object(n.isObject)(r)&&Object(n.has)(r,"uri")&&Object(n.has)(r,"hashIdNode"))return!0}(r)}))throw new Error("proofHandles Array contains invalid Objects");if(r.length>250)throw new Error("proofHandles arg must be an Array with <= 250 elements");var e=Object(n.reject)(r,function(r){return v(r.uri)});if(!Object(n.isEmpty)(e))throw new Error("some proof handles contain invalid URI values : ".concat(Object(n.map)(e,function(r){return r.uri}).join(", ")));var o=Object(n.reject)(r,function(r){return function(r){if(h(r,1))return!0}(r.hashIdNode)});if(!Object(n.isEmpty)(o))throw new Error("some proof handles contain invalid hashIdNode UUID values : ".concat(Object(n.map)(o,function(r){return r.hashIdNode}).join(", ")));return new c(function(e,o){try{var i={};Object(n.forEach)(r,function(r){Object(n.isEmpty)(i[r.uri])&&(i[r.uri]=[]),i[r.uri].push(r.hashIdNode)});var a=Object(n.map)(Object(n.keys)(i),function(r){var t=Object.assign({"content-type":"application/json"},{hashids:i[r].join(",")},g()?{"X-Node-Uri":r}:{});return{method:"GET",uri:(g()?y:r)+"/proofs",body:{},headers:t,timeout:1e4,json:!0}});c.map(a,b,{concurrency:25}).then(function(r){var i=Object(n.flatten)(r),a=[];try{Object(n.forEach)(i,function(r){r.anchors_complete=r.anchors_complete||[];var t=Object(n.mapKeys)(r,function(r,t){return Object(n.camelCase)(t)});a.push(t)})}catch(r){return o(r),t(r)}return e(a),t(null,a)},function(r){return o(r),t(r)})}catch(r){return o(r),t(r)}})}function P(r,t,e){e=e||function(){};var i,a=C(r);if(Object(n.isEmpty)(t))i=E(1);else{if(!Object(n.isString)(t))throw new Error("uri arg must be a String");if(!v(t))throw new Error("uri arg contains invalid Node URI : ".concat(t));i=c.resolve([t])}return new c(function(r,t){try{i.then(function(r){return Object(n.first)(r)}).then(function(r){var t=Object(n.map)(a,function(t){var e=s.parse(t.uri);return t.uri=r+e.path,t});return Object(n.uniqWith)(t,n.isEqual)}).then(function(r){var t=[];Object(n.forEach)(r,function(r){t.push(r.uri)});var e=Object(n.uniq)(t);return[r,Object(n.map)(e,function(r){var t=Object.assign({"content-type":"application/json"},g()?{"X-Node-Uri":s.parse(r).protocol+"//"+s.parse(r).host}:{});return{method:"GET",uri:g()?y+s.parse(r).path:r,body:{},headers:t,timeout:1e4,json:!0}})]}).then(function(r){var i=o(r,2),a=i[0],u=i[1];return[a,c.map(u,b,{concurrency:25}).then(function(r){var t=Object(n.flatten)(r),e={};return Object(n.forEach)(u,function(r,n){e[r.uri]=t[n]}),e}).catch(function(r){return t(r),e(r)})]}).then(function(i){var a=o(i,2),u=a[0];a[1].then(function(t){if(Object(n.isEmpty)(t))return c.reject(new Error("No hashes were found."));var o=[];return Object(n.forEach)(u,function(r){r.expected_value===t[r.uri]?(r.verified=!0,r.verified_at=(new Date).toISOString().slice(0,19)+"Z"):(r.verified=!1,r.verified_at=null);var e=Object(n.mapKeys)(r,function(r,t){return Object(n.camelCase)(t)});o.push(e)}),r(o),e(null,o)}).catch(function(r){return console.error(r.message),t(r),e(r)})}).catch(function(r){return console.error(r.message),t(r),e(r)})}catch(r){return t(r),e(r)}})}function C(r){if(!Object(n.isArray)(r))throw new Error("proofs arg must be an Array");if(Object(n.isEmpty)(r))throw new Error("proofs arg must be a non-empty Array");return x(function(r){if(!Object(n.isArray)(r))throw new Error("proofs arg must be an Array");if(Object(n.isEmpty)(r))throw new Error("proofs arg must be a non-empty Array");var t=[];return Object(n.forEach)(r,function(r){if(Object(n.isObject)(r))t.push(p.parse(r));else if(f.isJSON(r))t.push(p.parse(JSON.parse(r)));else{if(!(f.isBase64(r)||Object(n.isBuffer)(r)||_(r)))throw new Error("unknown proof format");t.push(p.parse(r))}}),t}(Object(n.map)(r,function(r){if(Object(n.isObject)(r)&&Object(n.has)(r,"proof")&&Object(n.isString)(r.proof))return r.proof;if(Object(n.isObject)(r)&&Object(n.has)(r,"type")&&"Chainpoint"===r.type)return r;if(Object(n.isString)(r)&&(f.isJSON(r)||f.isBase64(r)))return r;throw new Error("proofs arg Array has elements that are not Objects or Strings")})))}},function(r,t){r.exports=require("bluebird")},function(r,t){r.exports=require("dns")},function(r,t){r.exports=require("url")},function(r,t){r.exports=require("validator")},function(r,t){r.exports=require("uuid-validate")},function(r,t){r.exports=require("chainpoint-parse")},function(r,t){r.exports=require("request")},function(r,t){r.exports=require("request-promise")},function(r,t){r.exports=require("crypto")},function(r,t){r.exports=require("fs")},function(r,t){r.exports=require("uuid/v1")}])});
//# sourceMappingURL=bundle.js.map